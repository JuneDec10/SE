伺服器讯息区块

伺服器讯息区块（Server Message Block，缩写为SMB），又称网路文件共享系统（Common Internet File System，缩写为CIFS, ），一种应用层网络传输协议，由微软开发，主要功能是使网络上的机器能够共享计算机文件、打印机、串行端口和通讯等资源。它也提供经认证的行程间通讯机能。它主要用在装有Microsoft Windows的机器上，在这样的机器上被称为Microsoft Windows Network。

经过Unix服务器厂商重新开发后，它可以用于连接Unix服务器和Windows客户机，执行打印和文件共享等任务。

与功能类似的网络文件系统（NFS）相比，NFS的消息格式是固定长度，而CIFS的消息格式大多数是可变长度，这增加了协议的复杂性。CIFS消息一般使用NetBIOS或TCP协议传送，分别使用不同的端口139或445，目前倾向于使用445端口。CIFS的消息包括一个信头（32字节）和消息体（1个或多个，可变长）。

SMB可以以不同方式运行在会话层或者更低的网络层之上：



SMB的 "进程间通信" (IPC) 系统提供 命名管道s 机制，它使得程序员可以方便的实现继承认证(客户端第一次连接SMB服务获取认证信息后)。

一些服务的操作基于命名管道机制, 例如那些 Microsoft 内部实现的基于SMB的 DCE/RPC, 被称为基于SMB的 MSRPC, 同时允许 MSRPC 客户端程序 处理认证过程(借助SMB服务提供的认证服务实现), 但是只在MSRPC客户端程序上下文中有效。

"SMB 签名": Windows NT 4.0 Service Pack 3 及后续版本提供了基于数字签名的SMB连接机制。常用的官方术语叫做“SMB 签名”。其他被同时被使用的官方术语有 "[SMB] Security Signatures", "SMB sequence numbers" 和 "SMB Message Signing". SMB 签名可以分别配置 SMB 传入连接 (handled by the "LanManServer" service) 和 SMB 传出连接 (handled by the "LanManWorkstation" service). Windows 98 及后续版本上的默认设置是 opportunistically sign outgoing connections whenever the server also supports this. And to fall back to unsigned SMB if both partners allow this. Windows domain controllers from Server 2003 及后续版本的默认设置是 to not allow fall back for incoming connections. 这个特性也可以在任何 Windows NT 4.0 Service Pack 3 及后续版本上打开. This protects from man-in-the-middle attacks against the Clients retrieving their policies from domain controllers at login.

Server Message Block version 2 (SMB2) 旨在通过将SMB signals合并为一个数据包来减轻这个性能限制。

SMB 支持 机会锁 — 一种特殊的锁机制 — 来提升性能。

SMB 服务是 Microsoft's Distributed File System 实现的基础.

最初是的贝瑞·费根鲍姆（）研制的，其目的是将DOS操作系统中的本地文件接口“中断13”改造为网络文件系统。后来微软对这个发展进行了重大更改，这个更改后的版本也是最常见的版本。微软将协议与它和一起发展的网络管理程序结合在一起，并在和后来的版本中不断加入新的功能。

一开始的设计是在协议上运行的（而本身则运行在、或协议上），引入了直接在上运行的功能。在这里我们必须区分协议和运行在这个协议上的业务，以及和使用作为认证隧道的业务。此外我们还要区分主要（但不仅仅）直接使用数据报的“网络邻居”协议。

1996年，约于升阳推出的同时，微软提出将改称为。此外微软还加入了许多新的功能，比如符号链接、硬链接、提高文件的大小。微软还试图支持直接联系，不依靠，不过这个试图依然处于尝试阶段，并需要继续完善。微软向互联网工程工作小组提出了部分定义作为互联网草案。不过这些提案现在均已过期。

由于协议对于与占主要地位的平台通讯时的重要性，而目前该平台使用的协议与初始的版本相比有巨大的改变，因此项目就是被创立来逆向工程来提供一个与软件兼容的自由软件，使得非微软操作系统也能够使用它。

在中微软又推出了，后又在中做了改进，截至2012年依次发布的主版本有 2.1 和 3.0。

2006年，Microsoft 随着 Windows Vista 的发布 引入了新的SMB版本 (SMB 2.0 or SMB2) 

SMB 2.1, 随 Windows 7 和 Server 2008 R2 引入, 主要是通过引入新的机会锁机制来提升性能。

SMB 3.0 (previously named SMB 2.2)在Windows 8 和 Windows Server 2012中引入。它带来几项重大改变,例如 the SMB Direct Protocol (SMB over RDMA) 和 SMB Multichannel (multiple connections per SMB session),

使用点对点的通讯方式，一个客户端向一个服务器提出请求，服务器相应地回答。协议中的一部分专门用来处理对文件系统的访问，使得客户端可以访问一个文件服务器。也有行程间通讯的部分。协议尤其适用于局部子网，但是也可以被用来通过万维网来链接不同的子网。的文件和打印机分享主要使用这个功能。

服务器向网络上的客户端提供文件系统和其它资源。客户端电脑也可能有其自己的、不共享的硬盘，但是可能也想使用服务器上分享的文件系统和打印机。这是为什么这么出名和广泛地被使用的原因。普及的另一个原因是它使用适合网域的协议，至少提供基于网域式的认证。网域协议是一个微软远程过程调用服务，几乎只能被-{zh-tw:行程间通讯;zh-cn:进程间通讯}-的-{zh-tw:具名;zh-cn:命名}-管道使用。几乎所有服务器的实现使用网域来认证用户是否可以访问一个资源。

一般认为协议会占用很多网络带宽，因为每个客户端均在整个子网内广播其存在。但是本身并不使用广播。造成的广播问题实际上是的服务定位协议造成的。一般来说服务器使用来协议和定位服务。而则定时向一个特定的服务器广播一个服务的存在。对于一个少于20个服务器的网络来说这个方式是可行的。但是随服务器数目的增加广播造成的交通会导致问题。通过适当地实现WINS定位协议这个问题可以被缓和。使用更高级的系统来确定和中央化服务需求，但是造成自己的设计和保管网络的问题。动态是另一个解决方法。微软本身推荐在微软的活动目录环境下使用动态。网络延迟对协议的速度有非常大的冲击。在服务器之间网络延迟大的情况下通过来更换档案夹非常明显地反映了这个问题。比如在通过万维网使用虚拟私人网路时网络延迟就会比较大，这时使用就很恼人。

微软在实现其时添加了许多功能，比如微软引入了NTLMv2，因为原来的第1版使用的DES容易被破解。此外因早年美国政府对于高等加密软体限制出口，在美国以外仅使用40比特位加密，以今天的标准来说容易被解密。

的行程间通讯机制值得一提。通过这个系统，它提供-{zh-tw:具名;zh-cn:命名}-管道。这个机制是最早的、程序员可以使用的少数行程间通讯之一，它继承客户端联系服务器时的认证来提供服务。-{zh-tw:具名;zh-cn:命名}-管道继承认证是一个独特和透明的机制，因此使用的程序员和的用户均将它看作是自然的。

有些服务使用-{zh-tw:具名;zh-cn:命名}-管道，比如使用通过的微软远程过程调用的程序，也允许微软远程过程调用客户端程序进行自己的认证，并且由此掩盖服务器的认证。但是这个掩盖只在客户端程序的认证成功的情况下才生效。

另一个特点是对文件使用一种特殊的、被称为伺机锁定的锁定机构来提高速度。

微软的分布式文件系统实现就基于。

以下列出的包括客户端、服务器以及不同的扩展的协议。
多年以来，微软实现的其直接依赖的协议与组件都存在着许多安全漏洞。其他供应商的安全漏洞主要在于缺乏对较新的（例如和Kerberos赞成如NTLMv1、或纯文本密码）的支持。实时攻击跟踪表明SMB是入侵企图的主要攻击媒介之一，例如2014年索尼影业遭黑客攻击事件，以及2017年的WannaCry勒索软体攻击。


