Tor

Tor是实现匿名通信的自由软件。其名源于「The Onion Router」（洋葱路由器）的英语缩写。用户可透过Tor接达由全球志愿者免费提供，包含7000+个中继的覆盖网络，从而达至隐藏用户真实地址、避免网络监控及流量分析的目的。Tor用户的互联网活动（包括浏览在线网站、帖子以及即时消息等通讯形式）相对较难追踪。Tor的设计原意在于保障用户的个人私隐，以及不受监控地进行秘密通信的自由和能力。

Tor不会阻止在线网站判断用户是否通过Tor访问该网站。尽管它保护用户的私隐，但却不会掩饰用户正在使用Tor这一事实。有些网站会对使用Tor的用户进行限制。MediaWiki的扩充功能Torblock便是其中一个例子，其能自动地限制透过Tor进行的编辑。而使用了Torblock的维基百科则容许用户在某些情况下透过Tor编辑其内容。

Tor透过在5层协定栈中的应用层进行加密，从而实现洋葱路由这一种技术。Tor会对包括下一个中继的IP地址在内的数据，进行多次加密，并透过虚拟电路（包括随机选择的Tor中继）将其送出。每个中继都会对一层加密的数据进行解密，以知道数据的下一个传送目的地，然后将剩余的加密数据传送给它。最后的中继会解密最内层的加密数据，并在不会泄露或得知源IP地址的情况下，将原始数据发送至目标地址。

攻击者可能会尝试透过某些手段来使Tor用户去匿名化。包括利用Tor用户电脑上的软件漏洞。美国国家安全局拥有针对Tor安装包中所捆绑的旧版本Firefox漏洞的技术（代号「EgotisticalGiraffe」），并曾利用XKeyscore系统来密切监控Tor用户。不少学者亦就如何破解Tor网络进行过学术研究，此一行为受到Tor项目公司所肯定。

开发及维护Tor所需的一大部分费用由美国联邦政府所捐助，过去则以海军研究办公室及国防高等研究计划署的名义捐助。

Tor的核心技术“洋葱路由”，是在1990年代中期由美国海军研究实验室的员工，数学家保罗·西维森（Paul Syverson）和计算机科学家迈克·里德（G. Mike Reed）和大卫·戈尔德施拉格（David Goldschlag），为保护美国情报通信而开发的软件。之后，洋葱路由于1997年交由美国国防高等研究计划署进行进一步开发。

Tor的测试版由西维森和计算机科学家罗根·丁格伦（Roger Dingledine）和尼克·马修森（Nick Mathewson）开发 ，并将其命名为“洋葱路由项目”（The Onion Routing project，简称TOR项目）。这个测试版于2002年9月20日发布。次年推出首个公开发行版本。2004年8月13日，西维森、丁格伦和马修森在第13届USENIX安全研讨会上以「Tor：第二代洋葱路由器」为题进行演讲。2004年，美国海军研究实验室以自由软件许可证发布了Tor代码，电子前哨基金会开始资助丁格伦和马修森继续开发。

2006年12月，丁格伦、马修森等人成立了一个位于马萨诸塞州的非营利组织——The Tor Project，负责维护Tor。电子前哨基金会担任其早年的财政赞助商，Tor项目的早期赞助者还包括、新闻国际、人权观察、剑桥大学、谷歌和荷兰的。

此后维护Tor所需的一大部分费用由美国联邦政府所捐助。

2014年11月，由于全球司法部门开展了一项名为「」的反黑市行动，所以有推测指Tor的漏洞已被人利用。英国广播公司引述评论指这是「技术性破解」，使得司法部门可以追踪伺服器的物理位置。有关的法庭文件于次年引起人们对研究伦理及《美国宪法第四修正案》所保证的「不能受到无理搜查」的权利之关注，这也可能与当时稍早时候发生且针对Tor的攻击存有关系。

2015年12月，Tor专案公司宣布聘用莎丽·斯蒂尔（Shari Steele），由她担任新任执行董事。莎丽在这以前领导过电子前哨基金会15年之久，且在2004年使得电子前哨基金会决定为Tor的早期维护提供资金。其目标之一为增加Tor的用户友好度，使得更多人能够匿名地浏览网页。

2016年7月，Tor专案公司的董事会成员集体辞任，同时成立一个由、、、莱纳斯·诺德伯格（Linus Nordberg）、梅根·普赖斯（Megan Price）及布鲁斯·施奈尔组成的新董事会。

使用了Tor的用户可以匿名地浏览在线网站、聊天和发送即时信息。他们可把Tor应用于合法目的上，也可应用于非法目的上。例如犯罪企业、黑客行动主义组织及执法机关会为了各种目的而使用Tor
。除此之外，美国政府的内部机构会为Tor提供赞助（美国国务院、国家科学基金会，以及美国广播理事会皆有/曾为Tor提供赞助）并试图破解它。

Tor不能够使网络活动完全匿名。其设计目的并不是使网络跟踪完全消去，而是减低网站透过数据及活动跟踪用户的可能性。

Tor也被用于进行非法活动，例子包括存取在当地受到审查的资讯、组织政治运动
、规避禁止人们发表批评国家首脑的言论的法律。

《经济学人》的一篇报导称Tor跟比特币和丝路有关，并指Tor为「网络上的阴暗角落」。尽管美国国家安全局及英国政府通信总部已把Tor视为破解目标，但只取得少许成功。的「确认行动」（Operation Notarise）为最为成功破解Tor的行动。同时，英国政府通信总部利用了一款名为「Shadowcat」的工具来「透过Tor网络，并使用安全外壳协定存取受到端对端加密的虚拟专用服务器」。它也可应用于匿名诽谤、泄露政府敏感资讯、上下戴侵权作品、分发非法色情内容、贩卖受管制药物、武器及被盗的信用卡号码、洗钱、银行诈骗、、身份诈骗、假币兑换；以Tor为基础架构的黑市网站有相当一部分会以比特币作交易媒介。最后它还可用于攻击物联网设备。

美国联邦调查局在逮捕丝路的创办人的过程中，承认Tor「存有合法用途」。CNET的报导指，Tor的匿名功能「受到像电子前哨基金会般的民权组织的赞同，因为它能为告密者和人权工作者提供一个渠道，以跟记者沟通」。电子前哨基金会的监控自卫指南包含了如何使用Tor的描述，并指它符合保障私稳及匿名性的大原则。

电子前哨基金会的于2014年接受《彭博商业周刊》访问时指出：「Tor最大的问题就是新闻报道（的取向），没人听说过有些用户透过其摆脱滥用者的追踪，但只听说过人们如何透过其下载儿童色情作品」。

Tor专案公司指出，Tor用户当中也有「正常人」，这包括渴望网站及广告商不会得知自己的网上活动的人、担忧网络侦察的人，以及像活动家、记者和军事专业人士般渴望摆脱审查的用户。截至2013年11月，Tor有大约400万名用户。《华尔街日报》指出，Tor有约14％的流量来自美国，它的第二大用户群来自「网络审查盛行的国家」。家庭暴力的受害者、社工及帮助受害者的机构使用Tor沟通的情况也有上升趋势，尽管他们可能没受过网络安全相关的专业培训。然而若进行了适当的配置，它便可以使人不会受到数码追踪的影响。像《卫报》、《纽约客》、《ProPublica》及《The Intercept》般的新闻机构会利用SecureDrop及Tor来保障告密者的私隐。

于2015年3月发布了一份简要报告，当中指出「英国人普遍不会认为完全禁止线上匿名系统是可接受的……即使若事实并不如此，技术上这也是一项挑战」。除此之外，它进一步指出Tor「在线上观看和分发儿童不雅物品上，只扮演一个较小的角色（这可部分归因于Tor的<nowiki>固有</nowiki>延时）」。Tor也因能帮助网络观察基金会运作、告密者告密以及突破防火长城而受到热捧。

Tor的时任执行董事安德鲁·勒曼（Andrew Lewman）于2014年8月说道，美国国家安全局及英国政府通信总部的特务曾匿名地向Tor专案公司报告Tor的漏洞。

Tor项目的常见问题解答页面上写道：

Tor浏览器，前身为Tor Browser Bundle（TBB），是Tor项目的旗舰产品。由Mozilla Firefox ESR浏览器修改而成，并由Tor Project开发人员做了许多安全性和隐私保护的调校，预载TorButton、TorLauncher、NoScript和HTTPS Everywhere等扩充套件与Tor代理。其为开源软体、自由软体、绿色软件，可在多种作业系统上运行，包括Windows、Mac OS X、Linux、Unix、BSD、以及Android手机。现在也能于iOS使用，只要在App store 下载 Onion Browser 就可以。

Tor浏览器在后台启动Tor进程并透过其连接网络。一旦程序断开连接，Tor浏览器便会自动删除隐私敏感数据，如cookie和浏览历史记录。

Tor浏览器目前提供16种语言的介面，包括美国英语、阿拉伯语、法语、西班牙语、波斯语、德语、日语、意大利语、韩语、荷兰语、波兰语、俄语、土耳其语、巴西葡萄牙语、越南语、简体中文和繁体中文。

Tor浏览器本身提供SOCKS代理服务，一些应用程式已可借此使用Tor网路。若结合代理伺服器软体 Privoxy，可以让所有走HTTP/HTTPS协定的连网应用程式、以及所有能够设定HTTP/HTTPS代理的应用程式都透过Tor网路来上网。

Android平台上的Tor伺服器名为Orbot，并搭配Orfox或Tor Browser for Android (Alpha)浏览器来开启网页。Orbot本身可以当作VPN和Proxy使用，让用户指定同一装置上的任何程式通过Tor网路来匿名上网。

Tor用户在本机运行一个洋葱代理服务器（onion proxy），这个代理周期性地与其他Tor交流，从而在Tor网络中构成虚电路（virtual circuit）。Tor是在5层协议栈中的应用层进行加密（也就是按照'onion'的模式）。而它之所以被称为onion，是因为它的结构就跟洋葱相同，你只能看出它的外表，而想要看到核心，就必须把它层层的剥开。即每个路由器间的传输都经过对等密钥（symmetric key）来加密，形成有层次的结构。它中间所经过的各节点，都好像洋葱的一层皮，把客户端包在里面，算是保护信息来源的一种方式，这样在洋葱路由器之间可以保持通讯安全。同时对于客户端，洋葱代理服务器又作为SOCKS接口。一些应用程序就可以将Tor作为代理服务器，网络通讯就可以通过Tor的虚拟环路来进行。

进入Tor网络后，加密信息在路由器间层层传递，最后到达“出口节点”（exit node），明文数据从这个节点直接发往原来的目的地。对于目的地主机而言，是从“出口节点”发来信息。要注意的是明文资讯即使在Tor网路中是加密的，离开Tor后仍然是明文的。维基解密创始人便声称其公开的某些档案是截获于Tor的出口节点。

由于在TCP数据流的级别通讯，Tor显得卓然独立于其他匿名网络。通过使用Tor，一般的应用程序都可以实现匿名，比如IRC、即时通讯，以及浏览网页。浏览网页时，Tor常常与Privoxy或Polipo等联合使用，Privoxy、Polipo是开源代理服务器，可以在应用层增加保护隐私。

由于Tor可以匿名进行TCP传输，这就导致了被滥用的可能。路由器存放有一个“出口规则”（exit policy），内有各种地址、端口的组合规定，通过这个来区别哪些传输可以通过这个节点而离开Tor网络，这样就可能防范许多滥用的可能。潜在的滥用包括：
各种破坏与滥用行为导致许多的网站部分或完全限制对Tor的通讯。例如：

Tor不仅可以提供客户端的匿名访问，Tor还可以提供服务器的匿名。通过使用Tor网络，用户可以维护位置不可知的服务器。这些服务器所构成的网路被称为 "Tor Hidden Services"，资讯界又称为暗网，一般的网际网路则被相应地称为明网。因为在明网里，用户端和伺服端彼此知道对方的真实IP地址，而在暗网里双方互不知IP地址。若伺服端能做到不记录用户使用资讯，以及客户端能做到任何时刻都不输入真实个人资料，则透过Tor隐藏服务可以达成上网的完全匿名性。

如果要访问Tor隐藏服务，客户端必须安装Tor浏览器，在搭载Android作业系统的手机或平板电脑上，则必须安装Orfox。

在Tor浏览器里面，于网址列输入Tor隐藏网路特有的顶级域名codice_1，可以访问Tor隐藏服务（暗网）。Tor浏览器可以识别codice_1域名，并自动路由到隐藏的服务。然后，隐藏的服务将请求交由标准的服务器软件进行处理，这个服务器软件应该预先进行配置，从而只侦听非公开的接口。

Tor隐藏服务（暗网）有个另外的好处，由于不需要公开的IP地址，服务就可以躲在防火墙和NAT背后。但如果这个服务还可以通过一般的网际网路（明网）来访问，那也会受到相关连的攻击，这样就没有真正的隐藏起来。

Tor隐藏服务的例子（在非Tor的浏览器输入codice_1网址是无意义的）：

Tor在中国被许多人用于突破防火长城，这主要是因为中国大陆屏蔽了大量的海外网站和服务器。Tor会自动检测节点是否可达目标地址。如果返回错误无法到达，它会自动更换节点。相应地，这种技术也可以用在中国大陆境外模拟中国大陆境内的节点，以访问一些境外无法访问的内容。

而防火长城对于Tor一直没有很好的解决方法。现行比较有效的方法是对未使用SSL（HTTPS）加密的连接进行特征检测并重置连接，或对已知节点和网桥进行IP地址屏蔽，也有在中国境内建立Tor的虚假节点以对通过其传输的数据进行最大限度的审查。

作为反制，有部分大陆网民自发在中国境内建起网桥，帮助中国大陆境内未能连接上Tor网络的使用者连接。






美国国安局（NSA）及英国政府通讯总部（Government Communications Headquarter，GCHQ）于2012年6月发布名为Tor Stinks的简报档，档案中两国政府单位提及监听Tor网路困难重重，文中表示「无法辨识出所有Tor用户的身份。而以人工分析后，我们得以辨识非常小部份的Tor用户。」然而对特定呼叫有回应的用户，国安单位未成功辨识出任何身份。之后利用代号为「EgotisticalGiraffe」的技术（靠入侵Tor Browser Bundle基体软体Firefox的漏洞），NSA在用户可能造访的网站或论坛植入恶意程式，然后趁用户造访时植入其电脑，并借此搜集资料，监听Tor网路（The Onion Router）。虽然NSA表示这是为了瞄准恐怖份子或有组织的罪犯，但《卫报》表示，这类攻击也可能伤害到新闻记者、研究人员，或是不小心造访这些网站的人。而Mozilla已在2012年11月释出Firefox 17版修补了该漏洞。

2015年11月，Tor项目指责卡内基梅隆大学研究员在FBI的资助下攻击Tor的隐藏服务。该大学的研究人员Michael McCord和Alexander Volynkin通过设置大量节点，组合使用流量确认攻击和女巫攻击使Tor用户的身份去匿名化。最近公开的法庭文件确认了卡内基梅隆大学在其中扮演的角色——对Tor的攻击研究得到了美国国防部的资助。法庭文件针对的是暗网毒品市场丝路2.0的雇员Brian Farrell，执法部门通过向卡内基梅隆大学发去传票获得了Farrell的IP地址。。



